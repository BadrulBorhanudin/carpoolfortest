// testCache.js
require('dotenv').config();
const mongoose = require('mongoose');
const GeocodeCache = require('./models/GeocodeCache');

const testCacheFunctionality = async () => {
  try {
    await mongoose.connect(
      process.env.MONGODB_URI || 'mongodb://127.0.0.1:27017/car-pool-hub',
      {
        useNewUrlParser: true,
        useUnifiedTopology: true,
      }
    );

    // Clear previous test data
    await GeocodeCache.deleteMany({});

    // Test data
    const testAddress = '123 Test St, Test City, TC 12345';
    const testLat = 12.3456;
    const testLon = 65.4321;

    // Save test address to cache
    await GeocodeCache.create({
      address: testAddress,
      lat: testLat,
      lon: testLon,
    });
    console.log('Address successfully saved to cache.');

    // Retrieve the same address from cache
    const cachedResult = await GeocodeCache.findOne({ address: testAddress });
    console.log('Retrieved from cache:', cachedResult);

    await mongoose.disconnect();
  } catch (error) {
    console.error('Error testing cache functionality:', error);
  }
};

testCacheFunctionality();
